<Window x:Class="PoliticsQuizApp.WPF.ExamWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:local="clr-namespace:PoliticsQuizApp.WPF"
        Title="Thi Trắc Nghiệm" 
        WindowState="Maximized" 
        WindowStyle="None" 
        ResizeMode="NoResize" 
        Topmost="True" 
        ShowInTaskbar="False"
        Height="768" Width="1024"
        FontFamily="Segoe UI" Background="#F9FAFB">
    <!-- Background trắng xám nhẹ (Gray-50) -->

    <Window.Resources>
        <!-- Style cho Nút điều hướng (Tròn) -->
        <Style x:Key="NavButtonStyle" TargetType="Button">
            <Setter Property="Width" Value="38"/>
            <Setter Property="Height" Value="38"/>
            <Setter Property="Margin" Value="5"/>
            <Setter Property="Background" Value="White"/>
            <Setter Property="Foreground" Value="#64748B"/>
            <Setter Property="BorderBrush" Value="#E2E8F0"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="FontSize" Value="13"/>
            <Setter Property="FontWeight" Value="SemiBold"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border x:Name="border" Background="{TemplateBinding Background}" 
                                BorderBrush="{TemplateBinding BorderBrush}" BorderThickness="{TemplateBinding BorderThickness}" 
                                CornerRadius="19">
                            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter TargetName="border" Property="BorderBrush" Value="#94A3B8"/>
                                <Setter Property="Foreground" Value="#0F172A"/>
                            </Trigger>

                            <!-- Đã làm: Màu xanh lá dịu -->
                            <DataTrigger Binding="{Binding IsAnswered}" Value="True">
                                <Setter TargetName="border" Property="Background" Value="#F0FDF4"/>
                                <!-- Green-50 -->
                                <Setter TargetName="border" Property="BorderBrush" Value="#86EFAC"/>
                                <Setter Property="Foreground" Value="#166534"/>
                                <!-- Green-700 -->
                            </DataTrigger>

                            <!-- Đã Flag: Màu vàng cam -->
                            <DataTrigger Binding="{Binding IsFlagged}" Value="True">
                                <Setter TargetName="border" Property="Background" Value="#FFFBEB"/>
                                <!-- Amber-50 -->
                                <Setter TargetName="border" Property="BorderBrush" Value="#F63049"/>
                                <Setter Property="Foreground" Value="Black"/>
                            </DataTrigger>

                            <!-- Đang chọn: Màu đen/xám đậm -->
                            <DataTrigger Binding="{Binding IsSelected}" Value="True">
                                <Setter TargetName="border" Property="Background" Value="#1E293B"/>
                                <!-- Slate-800 -->
                                <Setter TargetName="border" Property="BorderBrush" Value="#1E293B"/>
                                <Setter Property="Foreground" Value="White"/>
                                <Setter Property="FontWeight" Value="Bold"/>
                            </DataTrigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <!-- Style cho Nút Hành động (Đen/Trắng tối giản) -->
        <Style x:Key="ActionButtonStyle" TargetType="Button">
            <Setter Property="Height" Value="46"/>
            <Setter Property="FontSize" Value="15"/>
            <Setter Property="FontWeight" Value="SemiBold"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border x:Name="border" Background="{TemplateBinding Background}" CornerRadius="6" 
                                BorderBrush="{TemplateBinding BorderBrush}" BorderThickness="{TemplateBinding BorderThickness}">
                            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter TargetName="border" Property="Opacity" Value="0.9"/>
                            </Trigger>
                            <Trigger Property="IsPressed" Value="True">
                                <Setter TargetName="border" Property="Opacity" Value="0.8"/>
                                <Setter Property="RenderTransform">
                                    <Setter.Value>
                                        <ScaleTransform ScaleX="0.98" ScaleY="0.98" CenterX="60" CenterY="23"/>
                                    </Setter.Value>
                                </Setter>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>
    </Window.Resources>

    <Grid>
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="*"/>
            <ColumnDefinition Width="320"/>
            <!-- Sidebar gọn hơn -->
        </Grid.ColumnDefinitions>

        <!-- === LEFT: QUESTION AREA === -->
        <!-- Bỏ viền bo quá cong, dùng viền vuông vức nhẹ nhàng hơn -->
        <Border Grid.Column="0" Margin="20" Background="White" CornerRadius="8" BorderBrush="#E5E7EB" BorderThickness="1">

            <Grid x:Name="gridQuestionContent" Margin="35">
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <!-- Header -->
                    <RowDefinition Height="*"/>
                    <!-- Content -->
                    <RowDefinition Height="Auto"/>
                    <!-- Footer -->
                </Grid.RowDefinitions>

                <!-- 1. Question Header -->
                <Grid Grid.Row="0" Margin="0,0,0,25">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>

                    <!-- Số thứ tự: Đen trên nền xám nhạt -->
                    <Border Grid.Column="0" Background="#F1F5F9" CornerRadius="6" Padding="12,6">
                        <TextBlock Text="{Binding Index, StringFormat='CÂU HỎI SỐ {0}'}" 
                                   FontSize="14" FontWeight="Bold" Foreground="#334155"/>
                    </Border>

                    <!-- Chủ đề -->
                    <TextBlock Grid.Column="1" x:Name="lblTopicName" Text="" 
                               VerticalAlignment="Center" Margin="15,0,0,0"
                               FontSize="14" Foreground="#94A3B8" FontStyle="Italic"/>

                    <!-- FIX LỖI FLAG: Dùng Style CheckBox giống nút bấm để dễ click -->
                    <CheckBox x:Name="chkFlag" Grid.Column="2" Content="Đánh dấu câu này" IsChecked="{Binding IsFlagged, Mode=TwoWay}"
                              Cursor="Hand" ToolTip="Đánh dấu để xem lại sau">
                        <CheckBox.Template>
                            <ControlTemplate TargetType="CheckBox">
                                <Border x:Name="border" Background="Transparent" BorderBrush="#CBD5E1" BorderThickness="1" CornerRadius="6" Padding="12,6">
                                    <StackPanel Orientation="Horizontal">
                                        <Path x:Name="flagIcon" Data="M14.4,6L14,4H5V21H7V14H12L12.4,16H19V6H14.4Z" 
                                              Fill="#94A3B8" Width="14" Height="14" Stretch="Uniform" Margin="0,0,8,0"/>
                                        <TextBlock x:Name="txtFlag" Text="Đánh dấu" FontSize="14" Foreground="#64748B" FontWeight="SemiBold"/>
                                    </StackPanel>
                                </Border>
                                <ControlTemplate.Triggers>
                                    <Trigger Property="IsChecked" Value="True">
                                        <Setter TargetName="border" Property="Background" Value="#FFFBEB"/>
                                        <Setter TargetName="border" Property="BorderBrush" Value="#F59E0B"/>
                                        <Setter TargetName="flagIcon" Property="Fill" Value="#F59E0B"/>
                                        <Setter TargetName="txtFlag" Property="Foreground" Value="#B45309"/>
                                        <Setter TargetName="txtFlag" Property="Text" Value="Đã đánh dấu"/>
                                    </Trigger>
                                    <Trigger Property="IsMouseOver" Value="True">
                                        <Setter TargetName="border" Property="Background" Value="#F8FAFC"/>
                                    </Trigger>
                                </ControlTemplate.Triggers>
                            </ControlTemplate>
                        </CheckBox.Template>
                    </CheckBox>
                </Grid>

                <!-- 2. Scrollable Content -->
                <ScrollViewer Grid.Row="1" VerticalScrollBarVisibility="Auto" Padding="0,0,10,0">
                    <StackPanel>
                        <!-- RichTextBox -->
                        <RichTextBox IsReadOnly="True" Background="Transparent" BorderThickness="0" 
                                     IsDocumentEnabled="True" FontSize="18" FontFamily="Segoe UI" Foreground="#0F172A"
                                     Padding="0" Margin="0,0,0,30"
                                     local:RichTextHelper.FormattedText="{Binding QuestionData.Content}">
                            <RichTextBox.Resources>
                                <Style TargetType="{x:Type Paragraph}">
                                    <Setter Property="Margin" Value="0,0,0,15"/>
                                    <Setter Property="LineHeight" Value="28"/>
                                </Style>
                            </RichTextBox.Resources>
                        </RichTextBox>

                        <!-- Answers Container -->
                        <StackPanel x:Name="pnlAnswers" Margin="5,0,0,0"/>
                    </StackPanel>
                </ScrollViewer>

                <!-- 3. Navigation Buttons -->
                <Grid Grid.Row="2" Margin="0,30,0,0">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="130"/>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="130"/>
                    </Grid.ColumnDefinitions>

                    <!-- Nút Trước: Trắng viền xám -->
                    <Button Grid.Column="0" Content="Câu trước" Click="BtnPrev_Click"
                            Background="White" Foreground="#334155" BorderBrush="#CBD5E1" BorderThickness="1"
                            Style="{StaticResource ActionButtonStyle}"/>

                    <!-- Nút Sau: Đen/Xám đậm (Thay cho màu xanh dương cũ) -->
                    <Button Grid.Column="2" Click="BtnNext_Click"
                            Background="#1E293B" Foreground="White" BorderThickness="0"
                            Style="{StaticResource ActionButtonStyle}">
                        <Button.Content>
                            <StackPanel Orientation="Horizontal">
                                <TextBlock Text="Câu sau" Margin="0,0,8,0"/>
                                <Path Data="M8.59,16.58L13.17,12L8.59,7.41L10,6L16,12L10,18L8.59,16.58Z" Fill="White" Width="10" Height="10" Stretch="Uniform"/>
                            </StackPanel>
                        </Button.Content>
                    </Button>
                </Grid>
            </Grid>
        </Border>

        <!-- === RIGHT: SIDEBAR === -->
        <Border Grid.Column="1" Background="White" BorderBrush="#E5E7EB" BorderThickness="1,0,0,0">
            <Grid Margin="20">
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>

                <!-- 1. Info -->
                <StackPanel Grid.Row="0" Margin="0,0,0,25">
                    <TextBlock Text="THÔNG TIN THÍ SINH" FontSize="12" FontWeight="Bold" Foreground="#94A3B8" Margin="0,0,0,10"/>
                    <TextBlock x:Name="lblStudentName" Text="Nguyễn Văn A" FontWeight="Bold" Foreground="#0F172A" FontSize="16" TextTrimming="CharacterEllipsis"/>
                    <TextBlock x:Name="lblExamTitle" Text="Đề thi: --" Foreground="#64748B" FontSize="14" Margin="0,4,0,0" TextTrimming="CharacterEllipsis"/>
                    <Separator Margin="0,15,0,0" Background="#F1F5F9"/>
                </StackPanel>

                <!-- 2. Timer (Viền đỏ nhẹ, chữ đỏ) -->
                <Border Grid.Row="1" Background="#FEF2F2" BorderBrush="#FECACA" BorderThickness="1" CornerRadius="8" Padding="15" Margin="0,0,0,25">
                    <StackPanel>
                        <TextBlock Text="THỜI GIAN CÒN LẠI" FontSize="11" Foreground="#EF4444" FontWeight="Bold" HorizontalAlignment="Center" Margin="0,0,0,5"/>
                        <TextBlock x:Name="lblTimer" Text="00:00" FontSize="36" FontWeight="Bold" Foreground="#DC2626" 
                                   HorizontalAlignment="Center" FontFamily="Segoe UI"/>
                    </StackPanel>
                </Border>

                <!-- 3. Progress -->
                <StackPanel Grid.Row="2" Margin="0,0,0,20">
                    <Grid Margin="0,0,0,5">
                        <TextBlock Text="Tiến độ làm bài" FontSize="13" Foreground="#475569" FontWeight="SemiBold"/>
                        <!-- Màu xanh nhẹ hơn cho tiến độ -->
                        <TextBlock x:Name="lblProgress" Text="0/0" HorizontalAlignment="Right" FontSize="13" FontWeight="Bold" Foreground="#0F172A"/>
                    </Grid>
                    <ProgressBar x:Name="prgBar" Height="6" Minimum="0" Maximum="10" Value="0" BorderThickness="0" Background="#F1F5F9">
                        <ProgressBar.Foreground>
                            <SolidColorBrush Color="#334155"/>
                            <!-- Màu xám đậm thay vì xanh -->
                        </ProgressBar.Foreground>
                    </ProgressBar>
                </StackPanel>

                <!-- 4. Navigator Grid -->
                <ScrollViewer Grid.Row="3" VerticalScrollBarVisibility="Auto">
                    <ItemsControl x:Name="icNavigator">
                        <ItemsControl.ItemsPanel>
                            <ItemsPanelTemplate>
                                <WrapPanel HorizontalAlignment="Center"/>
                            </ItemsPanelTemplate>
                        </ItemsControl.ItemsPanel>
                        <ItemsControl.ItemTemplate>
                            <DataTemplate>
                                <Button Content="{Binding Index}" 
                                        Click="BtnQuestionNav_Click" Tag="{Binding}"
                                        Style="{StaticResource NavButtonStyle}"
                                        ToolTip="Chuyển đến câu này"/>
                            </DataTemplate>
                        </ItemsControl.ItemTemplate>
                    </ItemsControl>
                </ScrollViewer>

                <!-- 5. Submit -->
                <Button Grid.Row="4" Content="NỘP BÀI THI" Click="BtnSubmit_Click" 
                        Height="50" Margin="0,20,0,0" Background="#EF4444" Foreground="White" 
                        FontSize="15" FontWeight="Bold" Cursor="Hand">
                    <Button.Template>
                        <ControlTemplate TargetType="Button">
                            <Border x:Name="border" Background="{TemplateBinding Background}" CornerRadius="6">
                                <StackPanel Orientation="Horizontal" HorizontalAlignment="Center" VerticalAlignment="Center">
                                    <Path Data="M5,20H19V18H5M19,9H15V3H9V9H5L12,16L19,9Z" Fill="White" Width="18" Height="18" Margin="0,0,10,0"/>
                                    <ContentPresenter/>
                                </StackPanel>
                            </Border>
                            <ControlTemplate.Triggers>
                                <Trigger Property="IsMouseOver" Value="True">
                                    <Setter TargetName="border" Property="Background" Value="#DC2626"/>
                                </Trigger>
                            </ControlTemplate.Triggers>
                        </ControlTemplate>
                    </Button.Template>
                </Button>
            </Grid>
        </Border>
    </Grid>
</Window>